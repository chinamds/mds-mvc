<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE xml>
<ehcache updateCheck="false" name="hibernateCache">

	<diskStore path="java.io.tmpdir/mds/ehcache/hibernate" />

	<!-- DefaultCache setting. -->
	<defaultCache maxEntriesLocalHeap="100" eternal="false" timeToIdleSeconds="300" timeToLiveSeconds="600" 
		overflowToDisk="true" maxEntriesLocalDisk="100000" />
		
	<!-- DSpace classes in the second level cache -->

    <!-- We only have 1 site object, so it is best to cache it -->
    <cache name="com.mds.content.model.Site"
           maxElementsInMemory="1" eternal="false" timeToIdleSeconds="86400"
           timeToLiveSeconds="86400" overflowToDisk="false"
           memoryStoreEvictionPolicy="LRU"/>

    <!-- The number of metadata schemas is limited and not updated frequently, so if we cache them
         the likelihood of a cache hit is very high -->
    <cache name="com.mds.content.model.MetadataSchema"
           maxElementsInMemory="100" eternal="false" timeToIdleSeconds="3600"
           timeToLiveSeconds="3600" overflowToDisk="true" diskExpiryThreadIntervalSeconds="60"
           memoryStoreEvictionPolicy="LRU"/>

    <!-- The number of metadata fields is limited and not updated frequently, so if we cache them
         the likelihood of a cache hit is very high -->
    <cache name="com.mds.content.model.MetadataField"
           maxElementsInMemory="2000" eternal="false"  timeToIdleSeconds="3600"
           timeToLiveSeconds="3600" overflowToDisk="true" diskExpiryThreadIntervalSeconds="60"
           memoryStoreEvictionPolicy="LRU"/>

    <!-- It is not a good idea to cache Item records. Most repositories have a large number of items
         so the cache would have to be updated frequently. In addition there are many processes that
         touch a lot of different items (discovery search, filter media, curation tasks...) which also makes
         the cache less efficient. The probably of having a cache hit is thus very low and that is why Items
         should not be cached. The same reasoning applies to Metadata values, Bundles, Bitstreams and Handles. -->

    <!-- The number of groups in a repository can be very big, but only a small percentage of them is used
         very frequently. So it makes sense to cache Group records because the cache hit rate is likely to be high -->
    <cache name="com.mds.eperson.model.Group"
           maxElementsInMemory="5000" eternal="false" timeToIdleSeconds="1800"
           timeToLiveSeconds="3600" overflowToDisk="false"
           memoryStoreEvictionPolicy="LRU"/>

    <!-- Like items, there are too many different Resource policy records for the cache to work efficiently.
         In addition, resource policies are the core security mechanism in DSpace so want need to be 100% we
         do not receive a stale policy when querying them. -->

    <!-- The total number of epersons in DSpace can be very large, but the number of concurrent authenticated users is mostly
         limited. Therefor having the authenticated users data cached will increase performance as the cache hit rate will
         be high. -->
    <cache name="com.mds.eperson.model.EPerson"
           maxElementsInMemory="1000" eternal="false" timeToIdleSeconds="1800"
           timeToLiveSeconds="1800" overflowToDisk="false"
           memoryStoreEvictionPolicy="LRU"/>

    <!-- The number of collections is mostly a fixed set in a repository which is not updated frequently. This means that
         most queries for a collection will be able to use the cached version. So adding caching here makes sense. -->
    <cache name="com.mds.content.model.Collection"
           maxElementsInMemory="4000" eternal="false" timeToIdleSeconds="1800"
           timeToLiveSeconds="1800" overflowToDisk="true" diskExpiryThreadIntervalSeconds="60"
           memoryStoreEvictionPolicy="LRU"/>

    <!-- Like collections, the same applies to communities. So we also setup a cache for communities. -->
    <cache name="com.mds.content.model.Community"
           maxElementsInMemory="2000" eternal="false" timeToIdleSeconds="1800"
           timeToLiveSeconds="1800" overflowToDisk="true" diskExpiryThreadIntervalSeconds="60"
           memoryStoreEvictionPolicy="LRU"/>
	
	<cache name="com.mds.i18n.model.Culture" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	
	<cache name="com.mds.sys.model.Dict" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	
	<cache name="com.mds.sys.model.Area" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	<cache name="com.mds.sys.model.Area.children" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	<cache name="com.mds.sys.model.Area.organizations" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	
	<cache name="com.mds.sys.model.Organization" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	<cache name="com.mds.sys.model.Organization.children" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	<cache name="com.mds.sys.model.Organization.staffs" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	
	<cache name="com.mds.sys.model.MenuFunction" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	<cache name="com.mds.sys.model.MenuFunction.children" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	<cache name="com.mds.sys.model.MenuFunction.menuFunctionPermissions" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	
	<cache name="com.mds.sys.model.Role" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	<cache name="com.mds.sys.model.Role.menuFunctionPermissions" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	<!-- <cache name="com.mds.sys.model.Role.users" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" /> -->
	
	<cache name="com.mds.sys.model.User" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	<cache name="com.mds.sys.model.User.roles" maxEntriesLocalHeap="100" eternal="false" overflowToDisk="true" maxEntriesLocalDisk="100000" />
	
	<cache name="com.mds.sys.model.UserOnline"
           maxEntriesLocalHeap="2000"
           eternal="false"
           timeToIdleSeconds="3600"
           timeToLiveSeconds="3600"
           overflowToDisk="false">
    </cache>
    <cache name="com.mds.sys.model.UserLastOnline"
           maxEntriesLocalHeap="2000"
           eternal="false"
           timeToIdleSeconds="3600"
           timeToLiveSeconds="3600"
           overflowToDisk="false">
    </cache>


    <cache
            name="org.hibernate.cache.internal.StandardQueryCache"
            maxEntriesLocalHeap="5000"
            eternal="false"
            timeToLiveSeconds="3600"
            overflowToDisk="false"/>

    <cache
            name="org.hibernate.cache.spi.UpdateTimestampsCache"
            maxEntriesLocalHeap="5000"
            eternal="true"
            overflowToDisk="true"/>
	
</ehcache>
